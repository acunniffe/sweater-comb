extends: [[spectral:oas, all]]

functions:
  - pathCasing

rules:
  openapi-tags: off
  operation-tags: off
  info-contact: off
  info-description: off
  info-license: off
  license-url: off

# Services must provide an OpenAPI specification

  openapi-get-versions:
    description: APIs must list the available versioned OpenAPI specifications.
    severity: error
    given: $.paths[/openapi]
    then:
      field: get
      function: truthy
    
  openapi-get-version:
    description: APIs must provide versioned OpenAPI specifications.
    severity: error
    given: $.paths[/openapi/{version}]
    then:
      field: get
      function: truthy
  
# Naming conventions

  paths-are-camel-cased:
    description: Path elements must be camelCase.
    message: "{{error}}"
    severity: error
    given: $.paths[*]~
    then:
      function: pathCasing
  
  parameter-names-are-camel-cased:
    description: Parameter names must be camelCase.
    message: "{{error}}"
    severity: error
    # TODO: Migrate pagination and remove exception for v3 projects, which was
    # released 2021-08-20~beta.
    given: $..parameters[?(@.name && !@.name.match(/^(ending_before|starting_after)$/))].name
    then:
      function: casing
      functionOptions:
        type: camel
  
  component-names-are-pascal-cased:
    description: Component names must be PascalCase (except response codes).
    message: "{{error}}"
    severity: error
    given: $..components[?(@property !== 'responses')][*]~
    then:
      field: "@key"
      function: casing
      functionOptions:
        type: pascal

  response-component-names-pascal-cased-or-numeric:
    description: Component names must be PascalCase (except response codes).
    message: "{{error}}"
    severity: error
    given: $..components[?(@property === 'responses')][?(!@property.match(/^\d+$/))]~
    then:
      field: "@key"
      function: casing
      functionOptions:
        type: pascal

# Versioning

## Version query parameter

## Version response headers

# JSON:API

## Content type

## Structure of responses
