# Linting rules for compiled API.next OpenAPI documents.

extends:
  - - spectral:oas
    - all
  - './jsonapi.yaml'
  - './naming.yaml'
  - './responses.yaml'
  - './spec.yaml'
  - './versioning.yaml'

rules:
  openapi-tags: off
  operation-tags: off
  info-contact: off
  info-description: off
  info-license: off
  license-url: off

  # Compiled specs must provide their own OpenAPI specification

  openapi-get-versions:
    description: APIs must list the available versioned OpenAPI specifications.
    severity: error
    given: $.paths[/openapi]
    then:
      field: get
      function: truthy

  openapi-get-version:
    description: APIs must provide versioned OpenAPI specifications.
    severity: error
    given: $.paths[/openapi/{version}]
    then:
      field: get
      function: truthy

  # Here for now. Probably a better place to put it
  openapi-route-tenant-uuids:
    description: APIs must use UUIDs where org or group tenants are specified
    severity: error
    given: $.paths[*][*].parameters[?(@.name.match(/org_id|group_id/))].schema
    then:
      - field: type
        function: enumeration
        functionOptions:
          values:
            - string

      - field: format
        function: truthy

      - field: format
        function: enumeration
        functionOptions:
          values:
            - uuid
